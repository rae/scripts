#!/bin/bash

# debugging
# set -x

p() {
    echo ""
    echo "$(date) -- $*"
}

cd $HOME

if [ ! -r /usr/local/bin/brew ]; then
	p Setting up homebrew
	/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

	# bring bash up-to-date with now-installed "brew" commands
	hash -r
fi

if [ ! -r /usr/bin/git ]; then
	p installing Xcode command line tools
	xcode-select --install
fi

if [ ! -r bin/noarch ]; then
	p Trying to use git to clone "'home'"
	git clone --recursive clith@clith.com:git/home
	mv -f .ssh .ssh-orig 2>/dev/null
	cd home
	mv -i * .[a-zA-Z0-9]* ~
	cd
	rmdir home
fi


# allow HOMEBREW_NO_AUTO_UPDATE to handle any required updating - will turn of off below
p installing ffmpeg JOVE, wget, cvs, p7zip, chocolate-doom youtube-dl libdvdcss
brew install ffmpeg jove wget cvs p7zip chocolate-doom youtube-dl libdvdcss

#do not update Homebrew again
export HOMEBREW_NO_AUTO_UPDATE=1

p installing verious casks
# not firefox
# not google-chrome
brew cask install -q \
	atom\
	qlmarkdown \
	sublime-text \
	textmate \
	\
	colloquy \
	discord \
	franz \
	google-hangouts \
	iterm2 \
	skype \
	slack \
	steam \
	telegram \
	transmission \
	whatsapp \
	\
	adobe-dng-converter \
	\
	dropbox \
	google-backup-and-sync \
	\
	4k-video-downloader \
	blender \
	freac \
	handbrake \
	krita \
	makemkv \
	qlvideo \
	soundcloud-downloader \
	vlc \
	\
	asset-catalog-tinkerer \
	cocoscreator \
	devdocs \
	gitup \
	godot \
	qlswift \
	sourcetree \
	texturepacker \
	\
	aerial \
	cyberduck \
	darktable \
	fission \
	gnucash \
	hockey \
	keybase \
	licecap \
	megasync \
	simple-comic \
	simple-comic \
	\
	adventure \
	angband \
	bzflag \
	gog-galaxy \
	ioquake3 \
	steamcmd \
	\
	geektool \
	mounty \
	postman \
	servetome \
	\
	mesasqlite \
	provisionql \
	qlmobi \


p Setting up macOS
# defaults write com.apple.menuextra.battery ShowPercent YES
defaults write com.apple.menuextra.clock DateFormat "EEE MMM d  HH:mm"

shotPList="~/Library/LaunchAgents/local.job.plist"
if [ ! -r "$shotPList" ]; then
	p Setting up screenshots launchd job (will need to logout and log back in)
	[ -d ~/Library/LaunchAgents ] || mkdir -p ~/Library/LaunchAgents
	cat > ~/Library/LaunchAgents/local.job.plist <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>Disabled</key>
	<false/>
	<key>Label</key>
	<string>local.job</string>
	<key>Program</key>
	<string>$HOME/bin/noarch-public/ss-rename</string>
	<key>RunAtLoad</key>
	<true/>
	<key>WatchPaths</key>
	<array>
		<string>$HOME/Desktop</string>
	</array>
</dict>
</plist>
EOF
fi

p All done.
